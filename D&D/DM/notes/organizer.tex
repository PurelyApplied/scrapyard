\documentclass{report}

\usepackage{hyperref} % makes ToC clickable

% \usepackage{dnd}
\usepackage{eso-pic} % allows background picture patterning
\usepackage{graphicx} % \includegraphics
\usepackage[left=1in,top=1in,right=1in,nohead]{geometry}
\usepackage{color} % Color DM only stuff
\usepackage{etoolbox} % \ifdef / \ifundef for setting
\usepackage{fp} % For simple arithmetic / mod calculation
\usepackage{amsmath}
\hypersetup{
  colorlinks,
  linktoc=all,
  linkcolor=blue,
  urlcolor=black
}

\newif\ifdm
\dmtrue

\newcommand{\dmonly}[1]{\ifdm{\color{blue}\hrulefill\textit{DM Only} #1 \hrulefill}\else{}\fi}

\newcommand{\headeritem}[2]{\newline\textbf{#1:} #2}

\newcommand{\race}[1]{\headeritem{Race}{#1}}
\newcommand{\class}[1]{\headeritem{Class}{#1}}
\newcommand{\voice}[1]{\headeritem{Voice}{#1}}
\newcommand{\player}[1]{\headeritem{Player}{#1}}

\newcommand{\STR}[1]{\renewcommand{\StrVal}{#1}}
\newcommand{\DEX}[1]{\renewcommand{\DexVal}{#1}}
\newcommand{\CON}[1]{\renewcommand{\ConVal}{#1}}
\newcommand{\INT}[1]{\renewcommand{\IntVal}{#1}}
\newcommand{\WIS}[1]{\renewcommand{\WisVal}{#1}}
\newcommand{\CHA}[1]{\renewcommand{\ChaVal}{#1}}

\newcommand{\statblock}[6]{\STR{#1}\DEX{#2}\CON{#3}\INT{#4}\WIS{#5}\CHA{#6}}

\newcommand{\modOf}[1]{%
\FPupn\unrounded{10.1 #1 - 2 swap /}%
\FPround\rounded\unrounded0%
\FPclip\result\rounded%
\FPifneg\result{%
\FPabs\absresult\result%
\FPround\rounded\absresult0%
\FPclip\newresult\rounded%
\texttt{-}\newresult%
}\else{%
\texttt{+}\result}\fi%
}

\newcommand{\reset}{
  \def\StrVal\undefined
  \def\DexVal\undefined
  \def\ConVal\undefined
  \def\IntVal\undefined
  \def\WisVal\undefined
  \def\ChaVal\undefined
}

\newcommand{\makeCharacterHeader}{%
  \begin{tabular}{cccccc}
    \stackrel{STR}{\StrVal(\modOf{\StrVal})} &
    \stackrel{DEX}{\DexVal(\modOf{\DexVal})} &
    \stackrel{CON}{\ConVal(\modOf{\ConVal})} &
    \stackrel{INT}{\IntVal(\modOf{\IntVal})} &
    \stackrel{WIS}{\WisVal(\modOf{\WisVal})} &
    \stackrel{CHA}{\ChaVal(\modOf{\ChaVal})}
  \end{tabular}
}

% \newenvironment{name}[args][default]{before}{after}
\newenvironment{character}[1]{
  \section{#1}
}{\reset}


\begin{document}

  \dmonly{{\LARGE
    This is the DM copy.
    If you're a player, this will have spoilers.
  }}

  \AddToShipoutPictureBG{\includegraphics{parchment-paper-light-texture.png}}

  \tableofcontents

  \include{setting/locations/main}
  \include{player-characters/main}
  \include{characters/main}
  \include{story/main}

\end{document}
